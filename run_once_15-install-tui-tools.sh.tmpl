#!/bin/bash
# plugins hash: {{ include "dot_config/zsh/plugins.zsh" | sha256sum }}
# plugins list hash: {{ include "dot_config/zsh/dot_zsh_plugins.txt" | sha256sum }}
set -euo pipefail

ANTIDOTE_DIR="${XDG_CONFIG_HOME:-$HOME/.config}/zsh/.antidote"
ZDOTDIR="${XDG_CONFIG_HOME:-$HOME/.config}/zsh"

if [[ -d "$ANTIDOTE_DIR" ]]; then
  echo "üîÑ Syncing ZSH plugins..."

  # Run antidote inside zsh (IMPORTANT FIX)
  ZDOTDIR="$ZDOTDIR" zsh -c "
    source '$ANTIDOTE_DIR/antidote.zsh'
    antidote update
  "

  echo "‚ö° Compiling ZSH configs..."

  for f in "$ZDOTDIR"/*.zsh; do
    zsh -c \"zcompile '$f'\" 2>/dev/null || true
  done

  echo "‚úÖ Plugins synced"

else
  echo "‚ö†Ô∏è Antidote not found, skipping plugin sync"
fi